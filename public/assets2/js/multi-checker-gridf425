"use strict";function _toConsumableArray(n){if(Array.isArray(n)){for(var t=0,i=Array(n.length);t<n.length;t++)i[t]=n[t];return i}return Array.from(n)}function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),Checker=function(){function n(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,n);this.isExist=function(n){return n!==undefined&&Object.keys(n).length>0};this.getID=function(n){return document.querySelector("#"+n)};this.selector=this.getID(t.selector);this.balls=t.balls;this.isExist(t.filters)&&(this.filters=t.filters);this.isExist(t.template)&&(this.template=t.template);this.isExist(t.parts)&&(this.parts=t.parts);this.isExist(t.views)?(this.views=t.views,this.defaultView=t.views.values[0]):this.defaultView="inline";this.isExist(t.translations)&&(this.translations=t.translations);this.isExist(t.cookies)&&(this.cookieValues=t.cookies);this.arrAvailability=[];this.checkCookies();this.initLines();this.initTwo();this.jsEnable()}return _createClass(n,[{key:"initTwo",value:function(){var n=this,t=this.parts,i=this.selector;this.selectors={};this.selectors.content=this.getID(t.content);this.selectors.add=this.getID(t.add);this.selectors.reset=this.getID(t.reset);this.selectors.hidden=this.getID(t.submit+"-value");this.selectors.submit=this.getID(t.submit);this.selectors.mode=this.getID(t.mode);this.selectors.jsAvailability=this.getID(t.jsAvailability);this.selectors.title=this.getID(t.title);this.views&&this.views.values.length>1&&(this.selectors.view=this.getID(this.views.id));this.filters&&Object.keys(this.filters).map(function(t){n.selectors[t]=n.getID(n.filters[t])});this.selectors.add.addEventListener("click",function(t){t.preventDefault();n.buildLine("add")});this.selectors.reset.addEventListener("click",function(t){t.preventDefault();n.isCookies=!1;n.deleteCookies();n.resetLines();n.footerReset();n.selectors.lines.innerHTML="";n.currentIndex=0;n.buildLine("add")});this.selectors.submit.addEventListener("click",function(t){t.preventDefault();n.checkBeforeSubmit()});this.selector.addEventListener("keydown",function(t){var i=document.activeElement;i.tagName==="INPUT"&&t.keyCode==13&&(t.preventDefault(),n.selectors.submit.disabled||n.checkBeforeSubmit())});this.view()}},{key:"footerReset",value:function(){var n=this.selectors;Object.keys(this.filters).map(function(t){n[t].querySelectorAll("option")[0].selected=!0})}},{key:"jsEnable",value:function(){var n=this.selectors;n.reset.style.display="inline-block";n.add.style.visibility="visible";n.mode.style.display="flex";n.jsAvailability.value="enable"}},{key:"view",value:function(){var n=this,t=this.selectors.view;t&&t.addEventListener("click",function(){n.defaultView=n.views.values[t.checked?1:0];n.render(n.defaultView)});this.render(this.defaultView)}},{key:"render",value:function(n){var u=this,r;this.currentIndex=0;var i=this.parts,t=this.selectors,f='<div id="'+i.lines+'"><\/div>',e='<div id="'+i.grid+'"><\/div>';t.content.innerHTML=f+(n==="inline"?"":e);r=t.title.dataset.title.split(",");t.title.innerHTML=r[n==="inline"?0:1];t.lines=this.getID(i.lines);this.lines.forEach(function(){u.buildLine()});n!=="inline"?(t.grid=this.getID(i.grid),this.createGrids(t.grid),t.content.classList.add("is-grid")):t.content.classList.remove("is-grid");document.activeElement.blur()}},{key:"initLines",value:function(){var t=this,i=this.cookies,r=this.balls,n;this.lines=[];this.isCookies?(n=JSON.parse(this.cookies.checkingNumbers),n.forEach(function(n){t.addLine(n)})):this.addLine()}},{key:"addLine",value:function(n){var r=this.balls,t={},i;t.result={};Object.keys(r).map(function(i){t.result[i]=n?n.result[i]:[]});this.lines.push(t);i={};i.result=!1;this.arrAvailability.push(i)}},{key:"buildLine",value:function(n){var f=this,u;n&&this.addLine();var i=this.balls,r=this.currentIndex,t=document.createElement("div");t.className="line";t.dataset.index=r;t.innerHTML='\n\t\t\t<div class="numbers">\n\t\t\t\t'+Object.keys(i).map(function(n){return"\n\t\t\t\t\t<ul>\n\t\t\t\t\t "+Array.from(Array(i[n].select).keys()).map(function(){return"\n\t\t\t\t\t \t<li>\n\t\t\t\t\t\t\t"+(f.defaultView==="inline"?'\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\ttype="tel"\n\t\t\t\t\t\t\t\t\tmin="'+(i[n].startWith!==undefined?""+i[n].startWith:"1")+'"\n\t\t\t\t\t\t\t\t\tmax="'+i[n].pool+'"\n\t\t\t\t\t\t\t\t\tmaxlength="2"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t':" <span><\/span>")+"\n\t\t\t\t\t \t<\/li>\n\t\t\t\t\t "}).join("")+"\n\t\t\t\t\t<\/ul>\n\t\t\t\t"}).join("")+'\n\t\t\t\t<div class="clean" data-type="result">&times;<\/div>\n\t\t\t<\/div>\n\t\t\t\n\t\t';this.selectors.lines.appendChild(t);u=t.querySelector("input");u&&u.focus();this.checkRemoveButtons();this.updateInputs(t,r);this.fillLine(r,"insert");n&&this.defaultView!=="inline"&&this.updateGrids();this.currentIndex+=1;this.checkLine(r);this.defaultView==="grid"&&document.activeElement.blur()}},{key:"checkRemoveButtons",value:function(){var r=this,t=[].concat(_toConsumableArray(this.selectors.lines.querySelectorAll(".line"))),i=this.parts.remove,n=void 0;t.forEach(function(t){n=t.querySelector("."+i);n!==null&&n.remove()});t.length>1&&t.forEach(function(t,u){n=document.createElement("div");n.className=i;var f=t.querySelector("."+i);f===null&&t.appendChild(n);n.addEventListener("click",function(){r.removeLine(u)})})}},{key:"updateNumbersOnClick",value:function(n,t,i,r){var o;this.lines[i]===undefined&&(i=this.currentIndex-1);var u=n.innerHTML.replace(/\D+/g,""),s=Object.keys(this.balls)[r],f=this.lines[i].result[s],e="";u.length===1&&(e="0"+u);t==="add"?f.push(u):t==="remove"?(o=f.indexOf(u)&&f.indexOf(e),f.splice(o,1)):alert(this.parts.selectedMessage);this.fillLine(i,"insert")}},{key:"updateInputs",value:function(n,t){var i=this,r,u;this.defaultView==="inline"&&(r=[].concat(_toConsumableArray(n.querySelector(".numbers").querySelectorAll("ul"))),r.forEach(function(n){var r=[].concat(_toConsumableArray(n.querySelectorAll("input")));r.forEach(function(n){n.addEventListener("input",function(n){i.fillLine(t,"reset");i.checkLine(t);i.keyboardMove(n,t,"forward")});i.keyboard(n,t)})}));u=[].concat(_toConsumableArray(n.querySelectorAll(".clean")));u.forEach(function(n){n.addEventListener("click",function(r){r.preventDefault();i.cleanInputs(n,t)})})}},{key:"cleanInputs",value:function(n,t){var f=this,u=n.parentNode,i=n.dataset.type,r=void 0;i==="result"?(r=[].concat(_toConsumableArray(u.querySelectorAll(this.defaultView==="inline"?"input":"span"))),Object.keys(this.lines[t][i]).map(function(n){f.lines[t][i][n]=[]})):(r=[].concat(_toConsumableArray(u.querySelectorAll("input"))),this.lines[t][i]="");r.forEach(function(n){var t=n.getAttribute("type");t!=="checkbox"&&(n.value="",n.innerHTML="",n.classList.remove("is-valid","is-invalid","is-dublicated"))});r[0].focus();this.updateGrids();this.checkLine()}},{key:"isFormatValid",value:function(n,t){n=[].concat(_toConsumableArray(n));t=[].concat(_toConsumableArray(t));var i=[];return n.forEach(function(n,r){/^\d$/.test(n)?i.push(/^\d$/.test(t[r])?!0:!1):i.push(/^\d$/.test(t[r])?!1:!0)}),i.indexOf(!1)===-1?!0:!1}},{key:"fillLine",value:function(n,t){var i=this,r=this.defaultView,u=this.selectors.lines.querySelectorAll(".line")[n];Object.keys(this.balls).map(function(f,e){i.lines[n].result[f]=[].concat(_toConsumableArray(new Set(i.lines[n].result[f])));t==="reset"&&(i.lines[n].result[f]=[]);var o=i.lines[n].result[f],s=[].concat(_toConsumableArray(u.querySelector(".numbers").querySelectorAll("ul")[e].querySelectorAll(r==="inline"?"input":"span")));s.forEach(function(u,e){var s=void 0,h,c;t==="insert"?(s=o[e],u[r==="inline"?"value":"innerHTML"]=s!==undefined?s:""):(s=u[r==="inline"?"value":"innerHTML"],h=Math.round(u.getAttribute("max")),c=Math.round(u.getAttribute("min")),s>h&&(s="",u.value=""),/^[0-9]*$/g.test(s)||(s="",u.value=""),s!==""&&i.lines[n].result[f].push(s));u.classList.remove("is-dublicated")})})}},{key:"resetLines",value:function(){this.lines=[];this.arrAvailability=[]}},{key:"removeLine",value:function(n){this.lines.splice(n,1);this.arrAvailability.splice(n,1);this.view()}},{key:"checkLine",value:function(n){var t=this,i=n!==undefined?n:this.currentIndex-1,r=this.lines[i],u=[],f={};Object.keys(this.balls).map(function(n,f){var e=t.checkLineDublicates(r.result[n],f,i);t.balls[n].optional||u.push(r.result[n].length===t.balls[n].select&&!e?!0:!1)});f.result=u.every(function(n){return n===!0});this.arrAvailability[i].result=f.result;this.updateFooter()}},{key:"checkLineDublicates",value:function(n,t,i){var r=[],u;return n.forEach(function(t,i){n.indexOf(t,i+1)>-1&&r.indexOf(t)===-1&&r.push(t)}),u=r.length>0?!0:!1,this.showDublicates(r,t,i),u}},{key:"showDublicates",value:function(n,t,i){i=this.selectors.lines.querySelectorAll(".line")[i];var r=[].concat(_toConsumableArray(i.querySelector(".numbers").querySelectorAll("ul")[t].querySelectorAll("input"))),u=[];if(r.forEach(function(n){u.push(n.value);n.classList.remove("is-dublicated")}),n.length===0)return!1;n.forEach(function(n){var t=u.reduce(function(t,i,r){return i===n?t.concat(r):t},[]);t.forEach(function(n){r[n].classList.add("is-dublicated")})})}},{key:"createGrids",value:function(n){var i=this,t=this.balls,r=this.lines.length-1,u="\n\t\t\t"+Object.keys(t).map(function(n){return'\n\t\t\t\t<div id="'+t[n].id+'">\n\t\t\t\t\t'+(t[n].optional?"\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<div>"+t[n].label+'<\/div>\n\t\t\t\t\t\t\t\t<input type="checkbox" '+(i.lines[r].result[n].length>0?"checked":"")+"/>\n\t\t\t\t\t\t\t<\/label>\n\t\t\t\t\t\t":"")+'\n\t\t\t\t\t<div class="grid" \n\t\t\t\t\t\t'+(t[n].optional&&i.lines[r].result[n].length===0?'style="display:none;"':"")+"\n\t\t\t\t\t>\n\t\t\t\t\t\t<h3>"+t[n].text+"<\/h3>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t"+Array.from(Array(t[n].pool).keys()).map(function(i){return'\n\t\t\t\t\t\t\t\t<li data-num="'+(t[n].startWith!==undefined?""+(i+t[n].startWith):""+(i+1))+'"\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t'+(t[n].startWith!==undefined?""+(i+t[n].startWith):""+(i+1))+"\n\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t"}).join("")+"\n\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t"}).join("")+"\n\t\t";n.innerHTML=u;Object.keys(t).map(function(n,t){var r=i.selectors.grid.querySelectorAll("div[id]")[t],f=[].concat(_toConsumableArray(r.querySelectorAll("li"))),u=r.querySelector("input");f.forEach(function(n,r){n.addEventListener("click",function(){i.addGridNumber(n,r,t)})});u!==null&&u.addEventListener("click",function(){i.addGrid(u,r.querySelector(".grid"),t)})});this.updateGrids()}},{key:"addGridNumber",value:function(n,t,i){var f=this.actualIndex!==undefined?this.actualIndex:this.currentIndex-1,e=this.selectors.lines.querySelectorAll(".line")[f],u,r;e===undefined&&(e=this.selectors.lines.querySelectorAll(".line")[this.currentIndex-1]);u=n.dataset.status;r=void 0;u==="selected"?(n.setAttribute("data-status",""),r="remove"):u!="disabled"?(n.setAttribute("data-status","selected"),r="add"):r="full";this.updateNumbersOnClick(n,r,f,i);this.updateGrids();this.checkLine()}},{key:"checkForFirstInvalidLine",value:function(){var i=this,n={},r=this.selectors.lines.querySelectorAll(".line");try{r.forEach(function(t,r){var u=t.querySelectorAll(".numbers span");u.forEach(function(t){if(t.innerHTML===""){i.actualIndex=r;throw n;}})})}catch(t){if(t!==n)throw t;}}},{key:"updateGrids",value:function(){var i=this,n,r,t,u;this.defaultView!=="inline"&&(this.checkForFirstInvalidLine(),n=this.actualIndex!==undefined?this.actualIndex:this.currentIndex-1,r=[].concat(_toConsumableArray(this.selectors.grid.querySelectorAll("ul"))),this.lines[n]===undefined&&(n=this.lines.length-1),t=this.lines[n],Object.keys(this.balls).map(function(n,u){var f,e,o;i.balls[n].optional&&(f=r[u].parentNode,e=f.parentNode.querySelector("label input"),t.result[n].length>0&&(e.checked=!0,i.addGrid(e,f,null)));o=[].concat(_toConsumableArray(r[u].querySelectorAll("li")));o.forEach(function(r){r.classList.remove("is-disabled");r.classList.remove("is-active");r.setAttribute("data-status","");t.result[n].length>=i.balls[n].select&&(r.classList.add("is-disabled"),r.setAttribute("data-status","disabled"));var u="";r.dataset.num.length===1&&(u="0"+r.dataset.num);(t.result[n].indexOf(r.dataset.num)>=0||t.result[n].indexOf(u)>=0)&&(r.classList.remove("is-disabled"),r.classList.add("is-active"),r.setAttribute("data-status","selected"))})}),u=this.selectors.lines.querySelectorAll(".line"),u.forEach(function(n){n.classList.remove("is-active")}),u[n].classList.add("is-active"))}},{key:"resetGrids",value:function(){this.checkForFirstInvalidLine();var n=[].concat(_toConsumableArray(this.selectors.grid.querySelectorAll("ul")));n.forEach(function(n){var t=[].concat(_toConsumableArray(n.querySelectorAll("li")));t.forEach(function(n){n.removeAttribute("data-status");n.classList.remove("is-active");n.classList.remove("is-disabled")})})}},{key:"addGrid",value:function(n,t,i){var r=this.actualIndex!==undefined?this.actualIndex:this.currentIndex-1,u=n.checked;t.style.display=u?"block":"none";u||(this.lines[r].result[Object.keys(this.lines[r].result)[i]]=[],this.updateGrids())}},{key:"updateFooter",value:function(){var t=this.selectors,n=!1;this.arrAvailability.forEach(function(t){Object.keys(t).map(function(i){if(t[i]===!0)return n=!0,!1})});t.submit.disabled=n?!1:!0}},{key:"checkBeforeSubmit",value:function(){var n=this,t=[],i;this.arrAvailability.forEach(function(i,r){var e=[],o,u,f;Object.keys(i).map(function(n){e.push(i[n])});e.indexOf(!0)===-1&&(o=n.selectors.lines.querySelectorAll(".line")[r],u=[].concat(_toConsumableArray(o.querySelectorAll(".numbers "+(n.defaultView==="inline"?"input":"span")))),console.log(u),f=[],u.forEach(function(t,i){var r=n.defaultView==="inline"?t.value:t.innerHTML;r===""&&f.push(i)}),f.length===u.length&&t.push(r))});t.reverse();t.forEach(function(t){n.removeLine(t)});i=[];this.arrAvailability.forEach(function(t,r){var u=[],f;Object.keys(t).map(function(n){u.push(t[n])});u.indexOf(!0)===-1&&(i.push(r),f=n.selectors.lines.querySelectorAll(".line")[r],n.checkForEmptyFields(f,r))});i.length===0&&this.submitForm()}},{key:"checkForEmptyFields",value:function(n){var r=this,t=[].concat(_toConsumableArray(n.querySelectorAll(".numbers "+(this.defaultView==="inline"?"input":"span")))),i=[];t.forEach(function(n,t){var u=r.defaultView==="inline"?n.value:n.innerHTML;u===""&&i.push(t)});i.forEach(function(n){t[n].classList.add("is-dublicated")})}},{key:"submitForm",value:function(){var n=this,t=[];this.arrAvailability.forEach(function(i,r){var u=[];Object.keys(i).map(function(t){u.push(i[t]);i[t]===!1&&(t==="result"?Object.keys(n.balls).map(function(t){n.lines[r].result[t]=[]}):n.lines[r][t]="")});u.indexOf(!0)===-1&&t.push(r)});t.reverse().forEach(function(t){n.lines.splice(t,1)});this.selectors.hidden=JSON.stringify(this.lines);this.createCookies();this.selector.submit()}},{key:"keyboard",value:function(n,t){var i=this,r=!1,u=!1;n.addEventListener("keyup",function(f){var o=n.value,e=f.keyCode||f.charCode;(e===8||e===46)&&o===""?i.keyboardMove(f,t,"back"):e===37&&r?i.keyboardMove(f,t,e):e===39&&u&&i.keyboardMove(f,t,e);r=f.target.selectionStart===0?!0:!1;u=f.target.selectionStart===n.value.length?!0:!1})}},{key:"keyboardMove",value:function(n,t,i){var o=this.selectors.lines.querySelectorAll(".line"),u=o[t].querySelectorAll("input"),r=void 0,f=0,e,s;if(u.forEach(function(n,t){if(n===document.activeElement)i==="forward"?n.value.length===parseInt(n.getAttribute("maxlength"))&&(r=t+1):i==="back"||i===37?r=t-1:i===39&&(r=t+1);else return}),e=void 0,r===-1&&o[t-1]){e=o[t-1].querySelectorAll("input");e[e.length-1].focus();return}u[r]!==undefined&&(n.preventDefault(),s=u[r].value,u[r].focus(),i==="back"||i===37?(f=u[r].value.length,u[r].setSelectionRange(f,f)):u[r].setSelectionRange(f,0),u[r].value=s)}},{key:"checkCookies",value:function(){var n=this,t=function(n){var t=document.cookie.match("(^|;) ?"+n+"=([^;]*)(;|$)");return t?decodeURIComponent(t[2].replace(/\+/g," ")):null},i=this.cookieValues;this.cookies={};i.forEach(function(i,r){n.cookies[i]=t(i);r===0&&n.cookies[i]!==null&&(n.isCookies=!0)})}},{key:"createCookies",value:function(){var t=new Date,n;t.setTime(t.getTime()+7776e6);n="expires="+t.toUTCString();document.cookie="checkingNumbers="+JSON.stringify(this.lines)+";"+n+"path=/;";document.cookie="checkingPeriod="+this.selectors.periods.value+";"+n+"path=/;";document.cookie="checkingDays="+this.selectors.days.value+";"+n+"path=/;"}},{key:"deleteCookies",value:function(){this.cookieValues.forEach(function(n){document.cookie=n+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/;";document.cookie=n+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"})}}]),n}()